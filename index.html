<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sistema de Gesti√≥n de Cursos T√©cnicos</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            --primary: #8b5cf6;
            --primary-dark: #7c3aed;
            --secondary: #06b6d4;
            --secondary-dark: #0891b2;
            --accent: #f472b6;
            --background: #fafafa;
            --surface: #ffffff;
            --text-primary: #1f2937;
            --text-secondary: #6b7280;
            --border: #e5e7eb;
            --success: #10b981;
            --warning: #f59e0b;
            --error: #ef4444;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
            background: linear-gradient(135deg, #faf5ff 0%, #f0f9ff 100%);
            color: var(--text-primary);
            line-height: 1.6;
            min-height: 100vh;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
        }

        /* Header */
        .header {
            background: linear-gradient(135deg, var(--primary) 0%, var(--secondary) 100%);
            color: white;
            padding: 30px 0;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            margin-bottom: 30px;
        }

        .header h1 {
            font-size: 2.5rem;
            font-weight: 700;
            text-align: center;
            margin-bottom: 10px;
        }

        .header p {
            text-align: center;
            opacity: 0.95;
            font-size: 1.1rem;
        }

        /* Navigation */
        .nav {
            background: var(--surface);
            border-radius: 12px;
            padding: 15px;
            margin-bottom: 30px;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.05);
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
            justify-content: center;
        }

        .nav-btn {
            padding: 12px 24px;
            border: none;
            background: var(--background);
            color: var(--text-primary);
            border-radius: 8px;
            cursor: pointer;
            font-weight: 600;
            font-size: 0.95rem;
            transition: all 0.3s ease;
            border: 2px solid transparent;
        }

        .nav-btn:hover {
            background: var(--primary);
            color: white;
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(139, 92, 246, 0.3);
        }

        .nav-btn.active {
            background: linear-gradient(135deg, var(--primary) 0%, var(--secondary) 100%);
            color: white;
            border-color: var(--primary);
        }

        /* Content Sections */
        .section {
            display: none;
            animation: fadeIn 0.3s ease;
        }

        .section.active {
            display: block;
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: translateY(10px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        /* Cards */
        .card {
            background: var(--surface);
            border-radius: 16px;
            padding: 30px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.08);
            margin-bottom: 25px;
            border: 1px solid var(--border);
        }

        .card-title {
            font-size: 1.75rem;
            font-weight: 700;
            color: var(--primary);
            margin-bottom: 20px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        /* Forms */
        .form-group {
            margin-bottom: 20px;
        }

        .form-label {
            display: block;
            font-weight: 600;
            color: var(--text-primary);
            margin-bottom: 8px;
            font-size: 0.95rem;
        }

        .form-input,
        .form-textarea,
        .form-select {
            width: 100%;
            padding: 12px 16px;
            border: 2px solid var(--border);
            border-radius: 8px;
            font-size: 1rem;
            transition: all 0.3s ease;
            font-family: inherit;
        }

        .form-input:focus,
        .form-textarea:focus,
        .form-select:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 3px rgba(139, 92, 246, 0.1);
        }

        .form-textarea {
            resize: vertical;
            min-height: 100px;
        }

        /* Buttons */
        .btn {
            padding: 14px 28px;
            border: none;
            border-radius: 8px;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            display: inline-flex;
            align-items: center;
            gap: 8px;
            justify-content: center;
        }

        .btn-primary {
            background: linear-gradient(135deg, var(--primary) 0%, var(--primary-dark) 100%);
            color: white;
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(139, 92, 246, 0.4);
        }

        .btn-secondary {
            background: linear-gradient(135deg, var(--secondary) 0%, var(--secondary-dark) 100%);
            color: white;
        }

        .btn-secondary:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(6, 182, 212, 0.4);
        }

        .btn-success {
            background: var(--success);
            color: white;
        }

        .btn-success:hover {
            background: #059669;
            transform: translateY(-2px);
        }

        /* Dashboard Grid */
        .dashboard-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .stat-card {
            background: linear-gradient(135deg, var(--primary) 0%, var(--secondary) 100%);
            color: white;
            padding: 25px;
            border-radius: 16px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
        }

        .stat-card h3 {
            font-size: 2.5rem;
            font-weight: 700;
            margin-bottom: 8px;
        }

        .stat-card p {
            opacity: 0.95;
            font-size: 1rem;
        }

        /* Course List */
        .course-list {
            display: grid;
            gap: 20px;
        }

        .course-item {
            background: var(--surface);
            border: 2px solid var(--border);
            border-radius: 12px;
            padding: 20px;
            transition: all 0.3s ease;
        }

        .course-item:hover {
            border-color: var(--primary);
            box-shadow: 0 4px 16px rgba(139, 92, 246, 0.15);
            transform: translateY(-2px);
        }

        .course-header {
            display: flex;
            justify-content: space-between;
            align-items: start;
            margin-bottom: 12px;
        }

        .course-title {
            font-size: 1.25rem;
            font-weight: 700;
            color: var(--primary);
        }

        .course-badge {
            padding: 6px 12px;
            border-radius: 20px;
            font-size: 0.8rem;
            font-weight: 600;
        }

        .badge-active {
            background: #d1fae5;
            color: #065f46;
        }

        .badge-pending {
            background: #fef3c7;
            color: #92400e;
        }

        .course-info {
            color: var(--text-secondary);
            margin-bottom: 15px;
        }

        /* Table */
        .table-container {
            overflow-x: auto;
        }

        .table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
        }

        .table th {
            background: linear-gradient(135deg, var(--primary) 0%, var(--secondary) 100%);
            color: white;
            padding: 15px;
            text-align: left;
            font-weight: 600;
        }

        .table td {
            padding: 15px;
            border-bottom: 1px solid var(--border);
        }

        .table tr:hover {
            background: var(--background);
        }

        /* Calendar */
        .calendar {
            background: var(--surface);
            border-radius: 12px;
            padding: 20px;
            border: 2px solid var(--border);
        }

        .calendar-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        .calendar-grid {
            display: grid;
            grid-template-columns: repeat(7, 1fr);
            gap: 10px;
        }

        .calendar-day {
            aspect-ratio: 1;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            padding: 10px;
            border-radius: 8px;
            border: 1px solid var(--border);
            cursor: pointer;
            transition: all 0.2s;
        }

        .calendar-day:hover {
            background: var(--primary);
            color: white;
            border-color: var(--primary);
        }

        .calendar-day.has-event {
            background: linear-gradient(135deg, var(--primary) 0%, var(--secondary) 100%);
            color: white;
            font-weight: 600;
        }

        /* Rankings */
        .ranking-list {
            list-style: none;
        }

        .ranking-item {
            display: flex;
            align-items: center;
            padding: 15px;
            margin-bottom: 10px;
            background: var(--background);
            border-radius: 10px;
            border-left: 4px solid var(--primary);
        }

        .ranking-position {
            font-size: 1.5rem;
            font-weight: 700;
            color: var(--primary);
            margin-right: 20px;
            min-width: 40px;
        }

        .ranking-info {
            flex: 1;
        }

        .ranking-name {
            font-weight: 600;
            font-size: 1.1rem;
        }

        .ranking-count {
            color: var(--text-secondary);
            font-size: 0.9rem;
        }

        /* Loading State */
        .loading {
            text-align: center;
            padding: 40px;
            color: var(--text-secondary);
        }

        .spinner {
            border: 3px solid var(--border);
            border-top: 3px solid var(--primary);
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
            margin: 0 auto 15px;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        /* Alert */
        .alert {
            padding: 15px 20px;
            border-radius: 8px;
            margin-bottom: 20px;
            display: none;
        }

        .alert.show {
            display: block;
            animation: slideDown 0.3s ease;
        }

        @keyframes slideDown {
            from {
                opacity: 0;
                transform: translateY(-10px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .alert-success {
            background: #d1fae5;
            color: #065f46;
            border-left: 4px solid var(--success);
        }

        .alert-error {
            background: #fee2e2;
            color: #991b1b;
            border-left: 4px solid var(--error);
        }

        /* Responsive */
        @media (max-width: 768px) {
            .header h1 {
                font-size: 1.75rem;
            }

            .nav {
                flex-direction: column;
            }

            .nav-btn {
                width: 100%;
            }

            .dashboard-grid {
                grid-template-columns: 1fr;
            }

            .course-header {
                flex-direction: column;
                gap: 10px;
            }

            .calendar-grid {
                grid-template-columns: repeat(4, 1fr);
            }
        }

        .two-column {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
        }

        @media (max-width: 768px) {
            .two-column {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <div class="header">
        <div class="container">
            <h1>üéì Sistema de Gesti√≥n de Cursos T√©cnicos</h1>
            <p>Plataforma de aprendizaje y desarrollo profesional</p>
        </div>
    </div>

    <div class="container">
        <!-- Alert Messages -->
        <div id="alertSuccess" class="alert alert-success"></div>
        <div id="alertError" class="alert alert-error"></div>

        <!-- Navigation -->
        <nav class="nav">
            <button class="nav-btn active" onclick="showSection('dashboard')">üìä Dashboard</button>
            <button class="nav-btn" onclick="showSection('propose')">‚ûï Proponer Curso</button>
            <button class="nav-btn" onclick="showSection('active')">üìö Cursos Activos</button>
            <button class="nav-btn" onclick="showSection('experts')">üë®‚Äçüè´ Expertos</button>
            <button class="nav-btn" onclick="showSection('calendar')">üìÖ Calendario</button>
            <button class="nav-btn" onclick="showSection('rankings')">üèÜ Rankings</button>
        </nav>

        <!-- Dashboard Section -->
        <section id="dashboard" class="section active">
            <div class="dashboard-grid">
                <div class="stat-card">
                    <h3 id="statProposed">0</h3>
                    <p>Cursos Propuestos</p>
                </div>
                <div class="stat-card" style="background: linear-gradient(135deg, var(--secondary) 0%, #0891b2 100%);">
                    <h3 id="statActive">0</h3>
                    <p>Cursos Activos</p>
                </div>
                <div class="stat-card" style="background: linear-gradient(135deg, var(--accent) 0%, #ec4899 100%);">
                    <h3 id="statRegistrations">0</h3>
                    <p>Inscripciones Totales</p>
                </div>
                <div class="stat-card" style="background: linear-gradient(135deg, var(--success) 0%, #059669 100%);">
                    <h3 id="statExperts">0</h3>
                    <p>Expertos Registrados</p>
                </div>
            </div>

            <div class="card">
                <h2 class="card-title">üìã Cursos Activos Recientes</h2>
                <div id="dashboardCourses" class="course-list"></div>
            </div>
        </section>

        <!-- Propose Course Section -->
        <section id="propose" class="section">
            <div class="card">
                <h2 class="card-title">‚ûï Proponer Nuevo Curso</h2>
                <form id="proposeCourseForm">
                    <div class="form-group">
                        <label class="form-label">T√≠tulo del Curso</label>
                        <input type="text" class="form-input" id="courseTitle" required>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Descripci√≥n</label>
                        <textarea class="form-textarea" id="courseDescription" required></textarea>
                    </div>
                    <div class="two-column">
                        <div class="form-group">
                            <label class="form-label">Categor√≠a</label>
                            <select class="form-select" id="courseCategory" required>
                                <option value="">Seleccionar...</option>
                                <option value="Programaci√≥n">Programaci√≥n</option>
                                <option value="Redes">Redes</option>
                                <option value="Seguridad">Seguridad</option>
                                <option value="Base de Datos">Base de Datos</option>
                                <option value="Cloud">Cloud Computing</option>
                                <option value="DevOps">DevOps</option>
                                <option value="Otro">Otro</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label class="form-label">Duraci√≥n (horas)</label>
                            <input type="number" class="form-input" id="courseDuration" min="1" required>
                        </div>
                    </div>
                    <button type="submit" class="btn btn-primary">Proponer Curso</button>
                </form>
            </div>

            <div class="card">
                <h2 class="card-title">üìù Cursos Propuestos</h2>
                <div id="proposedCoursesList"></div>
            </div>
        </section>

        <!-- Active Courses Section -->
        <section id="active" class="section">
            <div class="card">
                <h2 class="card-title">üìö Cursos Disponibles para Inscripci√≥n</h2>
                <div id="activeCoursesList" class="course-list"></div>
            </div>
        </section>

        <!-- Experts Section -->
        <section id="experts" class="section">
            <div class="card">
                <h2 class="card-title">üë®‚Äçüè´ Registrar Nuevo Experto</h2>
                <form id="createExpertForm">
                    <div class="two-column">
                        <div class="form-group">
                            <label class="form-label">Nombre Completo</label>
                            <input type="text" class="form-input" id="expertName" required>
                        </div>
                        <div class="form-group">
                            <label class="form-label">SAP</label>
                            <input type="text" class="form-input" id="expertSAP" required>
                        </div>
                    </div>
                    <div class="two-column">
                        <div class="form-group">
                            <label class="form-label">Email</label>
                            <input type="email" class="form-input" id="expertEmail" required>
                        </div>
                        <div class="form-group">
                            <label class="form-label">Especialidad</label>
                            <input type="text" class="form-input" id="expertSpecialty" required>
                        </div>
                    </div>
                    <button type="submit" class="btn btn-secondary">Registrar Experto</button>
                </form>
            </div>

            <div class="card">
                <h2 class="card-title">üë• Lista de Expertos</h2>
                <div class="table-container">
                    <table class="table" id="expertsTable">
                        <thead>
                            <tr>
                                <th>Nombre</th>
                                <th>SAP</th>
                                <th>Especialidad</th>
                                <th>Cursos Impartidos</th>
                                <th>Estado</th>
                            </tr>
                        </thead>
                        <tbody id="expertsTableBody"></tbody>
                    </table>
                </div>
            </div>
        </section>

        <!-- Calendar Section -->
        <section id="calendar" class="section">
            <div class="card">
                <h2 class="card-title">üìÖ Calendario de Cursos</h2>
                <div class="calendar">
                    <div class="calendar-header">
                        <button class="btn btn-primary" onclick="changeMonth(-1)">‚Üê Anterior</button>
                        <h3 id="calendarMonth"></h3>
                        <button class="btn btn-primary" onclick="changeMonth(1)">Siguiente ‚Üí</button>
                    </div>
                    <div class="calendar-grid" id="calendarGrid"></div>
                </div>
                <div id="calendarEvents" style="margin-top: 20px;"></div>
            </div>
        </section>

        <!-- Rankings Section -->
        <section id="rankings" class="section">
            <div class="two-column">
                <div class="card">
                    <h2 class="card-title">üèÜ Top Expertos</h2>
                    <p style="color: var(--text-secondary); margin-bottom: 20px;">Expertos con m√°s cursos impartidos</p>
                    <ul class="ranking-list" id="topExpertsList"></ul>
                </div>

                <div class="card">
                    <h2 class="card-title">‚≠ê Top Estudiantes</h2>
                    <p style="color: var(--text-secondary); margin-bottom: 20px;">Personal con m√°s cursos tomados</p>
                    <ul class="ranking-list" id="topStudentsList"></ul>
                </div>
            </div>
        </section>
    </div>

    <script>
        // ============================================
        // CONFIGURACI√ìN - REEMPLAZA CON TU URL
        // ============================================
        const SCRIPT_URL = 'TU_URL_DE_GOOGLE_APPS_SCRIPT_AQUI';

        // Verificar configuraci√≥n al cargar
        window.addEventListener('DOMContentLoaded', () => {
            if (SCRIPT_URL === 'TU_URL_DE_GOOGLE_APPS_SCRIPT_AQUI') {
                showAlert('‚ö†Ô∏è CONFIGURACI√ìN PENDIENTE: Debes reemplazar SCRIPT_URL con tu URL de Google Apps Script desplegada', 'error');
            }
            loadDashboard();
        });

        // Variables globales
        let currentMonth = new Date().getMonth();
        let currentYear = new Date().getFullYear();

        // ============================================
        // NAVEGACI√ìN
        // ============================================
        function showSection(sectionId) {
            // Ocultar todas las secciones
            document.querySelectorAll('.section').forEach(section => {
                section.classList.remove('active');
            });

            // Remover active de todos los botones
            document.querySelectorAll('.nav-btn').forEach(btn => {
                btn.classList.remove('active');
            });

            // Mostrar secci√≥n seleccionada
            document.getElementById(sectionId).classList.add('active');

            // Activar bot√≥n correspondiente
            event.target.classList.add('active');

            // Cargar datos seg√∫n la secci√≥n
            switch(sectionId) {
                case 'dashboard':
                    loadDashboard();
                    break;
                case 'propose':
                    loadProposedCourses();
                    break;
                case 'active':
                    loadActiveCourses();
                    break;
                case 'experts':
                    loadExperts();
                    break;
                case 'calendar':
                    loadCalendar();
                    break;
                case 'rankings':
                    loadRankings();
                    break;
            }
        }

        // ============================================
        // API CALLS
        // ============================================
        async function apiCall(action, method = 'GET', data = null) {
            try {
                // Verificar que la URL est√© configurada
                if (SCRIPT_URL === 'https://script.google.com/macros/s/AKfycbyeeD2g4nLN9lJeNb82J5QX6ywuSSdnqLJspBtTUE4IlWeA7YyLoaJAI_FICaukIX0/exec') {
                    showAlert('Error: URL del script no configurada. Lee INSTRUCCIONES.md', 'error');
                    return null;
                }

                const url = `${SCRIPT_URL}?action=${action}`;
                const options = {
                    method: method,
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    mode: 'cors'
                };

                if (method === 'POST' && data) {
                    options.body = JSON.stringify(data);
                }

                console.log('[v0] Llamando API:', action, method);
                const response = await fetch(method === 'POST' ? `${SCRIPT_URL}?action=${action}` : url, options);
                
                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }
                
                const result = await response.json();
                console.log('[v0] Respuesta API:', result);
                return result;
            } catch (error) {
                console.error('[v0] Error en API call:', error);
                let errorMsg = 'Error de conexi√≥n con el servidor. ';
                
                if (error.message.includes('Failed to fetch')) {
                    errorMsg += 'Verifica que: 1) El Apps Script est√© desplegado como Web App, 2) Los permisos sean "Anyone", 3) La URL sea correcta';
                } else if (error.message.includes('HTTP error')) {
                    errorMsg += `C√≥digo de error: ${error.message}`;
                } else {
                    errorMsg += error.message;
                }
                
                showAlert(errorMsg, 'error');
                return null;
            }
        }

        // ============================================
        // DASHBOARD
        // ============================================
        async function loadDashboard() {
            const stats = await apiCall('getStats');
            if (stats) {
                document.getElementById('statProposed').textContent = stats.cursosPropuestos;
                document.getElementById('statActive').textContent = stats.cursosActivos;
                document.getElementById('statRegistrations').textContent = stats.totalInscripciones;
                document.getElementById('statExperts').textContent = stats.totalExpertos;
            }

            const courses = await apiCall('getActiveCourses');
            if (courses) {
                displayDashboardCourses(courses.slice(0, 5));
            }
        }

        function displayDashboardCourses(courses) {
            const container = document.getElementById('dashboardCourses');
            if (courses.length === 0) {
                container.innerHTML = '<p style="color: var(--text-secondary); text-align: center;">No hay cursos activos</p>';
                return;
            }

            container.innerHTML = courses.map(course => `
                <div class="course-item">
                    <div class="course-header">
                        <div class="course-title">${course.titulo}</div>
                        <span class="course-badge badge-active">${course.estado}</span>
                    </div>
                    <div class="course-info">
                        <p>üë®‚Äçüè´ <strong>Experto:</strong> ${course.experto}</p>
                        <p>üìÖ <strong>Inicio:</strong> ${course.fechaInicio} | <strong>Fin:</strong> ${course.fechaFin}</p>
                        <p>üë• <strong>Inscritos:</strong> ${course.inscritos}/${course.cupos}</p>
                    </div>
                </div>
            `).join('');
        }

        // ============================================
        // PROPONER CURSOS
        // ============================================
        document.getElementById('proposeCourseForm').addEventListener('submit', async (e) => {
            e.preventDefault();

            const data = {
                titulo: document.getElementById('courseTitle').value,
                descripcion: document.getElementById('courseDescription').value,
                categoria: document.getElementById('courseCategory').value,
                duracion: document.getElementById('courseDuration').value
            };

            const result = await apiCall('proposeCourse', 'POST', data);

            if (result && result.success) {
                showAlert('¬°Curso propuesto exitosamente!', 'success');
                e.target.reset();
                loadProposedCourses();
            } else {
                showAlert('Error al proponer el curso', 'error');
            }
        });

        async function loadProposedCourses() {
            const courses = await apiCall('getProposedCourses');
            if (courses) {
                displayProposedCourses(courses);
            }
        }

        function displayProposedCourses(courses) {
            const container = document.getElementById('proposedCoursesList');
            if (courses.length === 0) {
                container.innerHTML = '<p style="color: var(--text-secondary); text-align: center;">No hay cursos propuestos</p>';
                return;
            }

            container.innerHTML = `
                <div class="course-list">
                    ${courses.map(course => `
                        <div class="course-item">
                            <div class="course-header">
                                <div class="course-title">${course.titulo}</div>
                                <span class="course-badge ${course.estado === 'Pendiente' ? 'badge-pending' : 'badge-active'}">
                                    ${course.estado}
                                </span>
                            </div>
                            <div class="course-info">
                                <p><strong>Categor√≠a:</strong> ${course.categoria}</p>
                                <p><strong>Duraci√≥n:</strong> ${course.duracion} horas</p>
                                <p><strong>Descripci√≥n:</strong> ${course.descripcion}</p>
                                ${course.expertoAsignado ? `<p><strong>Experto:</strong> ${course.expertoAsignado}</p>` : ''}
                            </div>
                        </div>
                    `).join('')}
                </div>
            `;
        }

        // ============================================
        // CURSOS ACTIVOS E INSCRIPCI√ìN
        // ============================================
        async function loadActiveCourses() {
            const courses = await apiCall('getActiveCourses');
            if (courses) {
                displayActiveCourses(courses);
            }
        }

        function displayActiveCourses(courses) {
            const container = document.getElementById('activeCoursesList');
            if (courses.length === 0) {
                container.innerHTML = '<p style="color: var(--text-secondary); text-align: center;">No hay cursos activos para inscripci√≥n</p>';
                return;
            }

            container.innerHTML = courses.map(course => `
                <div class="course-item">
                    <div class="course-header">
                        <div class="course-title">${course.titulo}</div>
                        <span class="course-badge badge-active">${course.estado}</span>
                    </div>
                    <div class="course-info">
                        <p>üë®‚Äçüè´ <strong>Experto:</strong> ${course.experto}</p>
                        <p>üìÖ <strong>Inicio:</strong> ${course.fechaInicio} | <strong>Fin:</strong> ${course.fechaFin}</p>
                        <p>üë• <strong>Cupos disponibles:</strong> ${course.cupos - course.inscritos}/${course.cupos}</p>
                    </div>
                    ${course.cupos > course.inscritos ? `
                        <button class="btn btn-success" onclick="showRegistrationForm('${course.id}', '${course.titulo}')">
                            Inscribirme
                        </button>
                    ` : '<p style="color: var(--error); font-weight: 600;">Sin cupos disponibles</p>'}
                </div>
            `).join('');
        }

        function showRegistrationForm(courseId, courseTitle) {
            const nombre = prompt(`Inscripci√≥n a: ${courseTitle}\n\nIngresa tu nombre completo:`);
            if (!nombre) return;

            const sap = prompt('Ingresa tu n√∫mero SAP:');
            if (!sap) return;

            registerForCourse(courseId, nombre, sap);
        }

        async function registerForCourse(courseId, nombre, sap) {
            const data = {
                idCurso: courseId,
                nombre: nombre,
                sap: sap
            };

            const result = await apiCall('registerForCourse', 'POST', data);

            if (result && result.success) {
                showAlert('¬°Inscripci√≥n exitosa!', 'success');
                loadActiveCourses();
            } else {
                showAlert(result?.error || 'Error al inscribirse', 'error');
            }
        }

        // ============================================
        // EXPERTOS
        // ============================================
        document.getElementById('createExpertForm').addEventListener('submit', async (e) => {
            e.preventDefault();

            const data = {
                nombre: document.getElementById('expertName').value,
                sap: document.getElementById('expertSAP').value,
                email: document.getElementById('expertEmail').value,
                especialidad: document.getElementById('expertSpecialty').value
            };

            const result = await apiCall('createExpert', 'POST', data);

            if (result && result.success) {
                showAlert('¬°Experto registrado exitosamente!', 'success');
                e.target.reset();
                loadExperts();
            } else {
                showAlert('Error al registrar experto', 'error');
            }
        });

        async function loadExperts() {
            const experts = await apiCall('getExperts');
            if (experts) {
                displayExperts(experts);
            }
        }

        function displayExperts(experts) {
            const tbody = document.getElementById('expertsTableBody');
            if (experts.length === 0) {
                tbody.innerHTML = '<tr><td colspan="5" style="text-align: center; color: var(--text-secondary);">No hay expertos registrados</td></tr>';
                return;
            }

            tbody.innerHTML = experts.map(expert => `
                <tr>
                    <td><strong>${expert.nombre}</strong></td>
                    <td>${expert.sap}</td>
                    <td>${expert.especialidad}</td>
                    <td>${expert.cursosImpartidos}</td>
                    <td>
                        <span class="course-badge ${expert.disponible === 'S√≠' ? 'badge-active' : 'badge-pending'}">
                            ${expert.disponible === 'S√≠' ? 'Disponible' : 'No disponible'}
                        </span>
                    </td>
                </tr>
            `).join('');
        }

        // ============================================
        // CALENDARIO
        // ============================================
        async function loadCalendar() {
            renderCalendar();
            const schedules = await apiCall('getSchedules');
            if (schedules) {
                displayCalendarEvents(schedules);
            }
        }

        function renderCalendar() {
            const firstDay = new Date(currentYear, currentMonth, 1).getDay();
            const daysInMonth = new Date(currentYear, currentMonth + 1, 0).getDate();

            const monthNames = ['Enero', 'Febrero', 'Marzo', 'Abril', 'Mayo', 'Junio',
                              'Julio', 'Agosto', 'Septiembre', 'Octubre', 'Noviembre', 'Diciembre'];

            document.getElementById('calendarMonth').textContent = `${monthNames[currentMonth]} ${currentYear}`;

            const grid = document.getElementById('calendarGrid');
            grid.innerHTML = '';

            // D√≠as de la semana
            ['Dom', 'Lun', 'Mar', 'Mi√©', 'Jue', 'Vie', 'S√°b'].forEach(day => {
                const dayHeader = document.createElement('div');
                dayHeader.textContent = day;
                dayHeader.style.fontWeight = '600';
                dayHeader.style.textAlign = 'center';
                dayHeader.style.padding = '10px';
                dayHeader.style.color = 'var(--primary)';
                grid.appendChild(dayHeader);
            });

            // Espacios en blanco antes del primer d√≠a
            for (let i = 0; i < firstDay; i++) {
                const emptyDay = document.createElement('div');
                grid.appendChild(emptyDay);
            }

            // D√≠as del mes
            for (let day = 1; day <= daysInMonth; day++) {
                const dayElement = document.createElement('div');
                dayElement.className = 'calendar-day';
                dayElement.textContent = day;

                // Marcar d√≠a actual
                const today = new Date();
                if (day === today.getDate() && currentMonth === today.getMonth() && currentYear === today.getFullYear()) {
                    dayElement.style.background = 'var(--secondary)';
                    dayElement.style.color = 'white';
                }

                grid.appendChild(dayElement);
            }
        }

        function changeMonth(direction) {
            currentMonth += direction;
            if (currentMonth > 11) {
                currentMonth = 0;
                currentYear++;
            } else if (currentMonth < 0) {
                currentMonth = 11;
                currentYear--;
            }
            loadCalendar();
        }

        function displayCalendarEvents(schedules) {
            const container = document.getElementById('calendarEvents');
            if (schedules.length === 0) {
                container.innerHTML = '<p style="color: var(--text-secondary); text-align: center;">No hay eventos programados</p>';
                return;
            }

            container.innerHTML = `
                <div class="card">
                    <h3 class="card-title">üìã Eventos Programados</h3>
                    <div class="table-container">
                        <table class="table">
                            <thead>
                                <tr>
                                    <th>Fecha</th>
                                    <th>Horario</th>
                                    <th>Estado</th>
                                </tr>
                            </thead>
                            <tbody>
                                ${schedules.map(schedule => `
                                    <tr>
                                        <td>${schedule.fecha}</td>
                                        <td>${schedule.horaInicio} - ${schedule.horaFin}</td>
                                        <td>
                                            <span class="course-badge badge-active">${schedule.estado}</span>
                                        </td>
                                    </tr>
                                `).join('')}
                            </tbody>
                        </table>
                    </div>
                </div>
            `;
        }

        // ============================================
        // RANKINGS
        // ============================================
        async function loadRankings() {
            const topExperts = await apiCall('getTopExperts');
            const topStudents = await apiCall('getTopStudents');

            if (topExperts) displayTopExperts(topExperts);
            if (topStudents) displayTopStudents(topStudents);
        }

        function displayTopExperts(experts) {
            const container = document.getElementById('topExpertsList');
            if (experts.length === 0) {
                container.innerHTML = '<p style="color: var(--text-secondary); text-align: center;">No hay datos disponibles</p>';
                return;
            }

            container.innerHTML = experts.map((expert, index) => `
                <li class="ranking-item">
                    <div class="ranking-position">${index + 1}</div>
                    <div class="ranking-info">
                        <div class="ranking-name">${expert.nombre}</div>
                        <div class="ranking-count">${expert.cursosImpartidos} cursos impartidos ‚Ä¢ ${expert.especialidad}</div>
                    </div>
                </li>
            `).join('');
        }

        function displayTopStudents(students) {
            const container = document.getElementById('topStudentsList');
            if (students.length === 0) {
                container.innerHTML = '<p style="color: var(--text-secondary); text-align: center;">No hay datos disponibles</p>';
                return;
            }

            container.innerHTML = students.map((student, index) => `
                <li class="ranking-item">
                    <div class="ranking-position">${index + 1}</div>
                    <div class="ranking-info">
                        <div class="ranking-name">${student.nombre}</div>
                        <div class="ranking-count">${student.cursosTomados} cursos tomados ‚Ä¢ SAP: ${student.sap}</div>
                    </div>
                </li>
            `).join('');
        }

        // ============================================
        // UTILIDADES
        // ============================================
        function showAlert(message, type) {
            const alertId = type === 'success' ? 'alertSuccess' : 'alertError';
            const alert = document.getElementById(alertId);
            alert.textContent = message;
            alert.classList.add('show');

            setTimeout(() => {
                alert.classList.remove('show');
            }, 5000);
        }

        // ============================================
        // INICIALIZACI√ìN
        // ============================================
        window.addEventListener('load', () => {
            loadDashboard();
        });
    </script>
</body>
</html>
